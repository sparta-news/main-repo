<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‰´ìŠ¤ ìƒì„¸ í˜ì´ì§€</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      width: 100%;
      background-color: #03C75A;
      color: white;
      padding: 10px;
      display: flex;
      align-items: center;
    }

    .home-button {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .home-button i {
      font-size: 24px;
    }

    header h1 {
      margin: 0;
      padding-left: 10px;
      font-size: 24px;
    }

    .content-container {
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .left-space {
      width: 15%;
      background-color: white;
    }

    /* .right-space {
      width: 15%;
      background-color: #d9f2e6;
    } */

    main {
      width: 50%;
      background-color: white;
      padding: 20px;
    }

    #contents {
      white-space: pre-line;
    }

    aside {
      width: 35%;
      background-color: #d9f2e6;
      padding: 15px;
    }

    .category {
      display: flex;
      gap: 10px;
      padding: 10px;
      justify-content: center;
      background-color: #d9f2e6;
    }

    .category button {
      background-color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 5px;
      font-size: x-small;
    }

    aside ul {
      list-style: none;
      padding: 0;
    }

    aside li {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }

    aside img {
      width: 50px;
      height: 50px;
      margin-right: 10px;
    }

    .rating {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    .rating button {
      padding: 10px;
      border: none;
      cursor: pointer;
      font-size: 20px;
      border-radius: 20px;
    }
  </style>
  <script type="module">



    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, doc, getDoc, getDocs, query, where, orderBy, limit, Timestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // Firebase êµ¬ì„± ì •ë³´
    const firebaseConfig = {

    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const options = { year: 'numeric', month: '2-digit', day: '2-digit' };


    // docid: ë¶ˆëŸ¬ì˜¤ê³ ì í•˜ëŠ” ê¸°ì‚¬ì˜ ê³ ìœ ê°’
    const urlParams = new URLSearchParams(window.location.search);
    const docId = urlParams.get('id');


    // id ê°’ì— ë§ëŠ” main í™”ë©´ ë¡œë“œ
    async function getDocument() {
      const docRef = doc(db, "news", docId);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        let news = docSnap.data();

        let title = news['title'];
        let reporter = news['reporter'];
        let category = news['category'];
        let contents = news['contents'];
        let date = news['date'];
        let rating0 = news['rating'][0]
        let rating1 = news['rating'][1]
        let rating2 = news['rating'][2]
        let rating3 = news['rating'][3]
        let rating4 = news['rating'][4]
        let image = news['image'];//

        let date_temp1 = date.seconds * 1000 + Math.floor(date.nanoseconds / 1000000);
        let date_temp2 = new Date(date_temp1);

        let formattedContents = contents.replace(/\./g, '.\n\n');
        $("#contents").text(formattedContents);
        $("#title").text(title);

        let DR_data = `ë‚ ì§œ: ${new Intl.DateTimeFormat('ko-KR', options).format(date_temp2)} ê¸°ì: ${reporter}`
        $("#DR").text(DR_data);

        let image_html = `<img src="${image}" alt="ë‰´ìŠ¤ ì´ë¯¸ì§€" style="width: 60%;">`
        $("#main_image").empty();
        $("#main_image").append(image_html);

      } else {
        console.log("í•´ë‹¹ ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }

    }

    //onclick ì‚¬ìš©(í‰ê°€ í•­ëª©) db ì—°ê²° í•„ìš”
    function rateNews(level) {
      let countSpan = document.getElementById(`count-${level}`);
      let currentCount = parseInt(countSpan.textContent) || 0;
      countSpan.textContent = currentCount + 1;
    }

    getDocument();

    let side_ctgy = "ì •ì¹˜";

    async function getPoliticalNews(ctgy) {
      const startDate = Timestamp.fromDate(new Date("2020-12-01"));
      // ğŸ”¹ "news" ì»¬ë ‰ì…˜ì—ì„œ categoryê°€ "ì •ì¹˜"ì¸ ë¬¸ì„œë§Œ ê°€ì ¸ì˜¤ê¸°
      const q = query(collection(db, "news"), where("category", "==", ctgy), orderBy("date", "desc"), limit(5));
      const querySnapshot = await getDocs(q);
      $('#side_bar').empty();

      // ğŸ”¹ ê°€ì ¸ì˜¨ ë¬¸ì„œë“¤ ë°˜ë³µ ì²˜ë¦¬
      querySnapshot.forEach((doc) => {
        let data = doc.data();

        let side_html = `<li><img src="${data.image}" alt = "ë‰´ìŠ¤1" ><a href= "detail_page.html?id=${doc.id}"> ${data.title}</a></li>`;
        console.log(side_html)
        $('#side_bar').append(side_html);
      });
    }

    getPoliticalNews(side_ctgy)

    $("#politics").click(async function () {
      let a = "ì •ì¹˜"
      getPoliticalNews(a);
    })

    $("#economy").click(async function () {
      let b = "ê²½ì œ"
      getPoliticalNews(b);
    })

    $("#society").click(async function () {
      let c = "ì‚¬íšŒ"
      getPoliticalNews(c);
    })

    $("#life").click(async function () {
      let d = "ìƒí™œ"
      getPoliticalNews(d);
    })

    $("#science").click(async function () {
      let e = "ê³¼í•™"
      getPoliticalNews(e);
    })

    $("#world").click(async function () {
      let f = "ì„¸ê³„"
      getPoliticalNews(f);
    })

    $("#home_btn").click(async function () {
      window.location.href = "home.html";
    })

  </script>
</head>

<body>
  <header>
    <button class="home-button" id = 'home_btn'>
       ğŸ“°(í™ˆë²„íŠ¼)
    </button>
    <h1>NEWS</h1>
  </header>
  <div class="content-container">
    <div class="left-space"></div>
    <main>
      <h2><strong><span id='title'>ë‰´ìŠ¤ ì œëª©</span></strong></h2>
      <div>
        <p><span id='DR'>ë‚ ì§œ, ê¸°ì‚¬</span></p>
      </div>
      <div id="main_image"></div>
      <!-- <img src="" alt="ë‰´ìŠ¤ ì´ë¯¸ì§€" style="width: 100%;"> -->
      <p id="contents">ë‰´ìŠ¤ ë‚´ìš©<br><br> </p>

      <!-- rating ê¸°ëŠ¥ êµ¬í˜„ í•„ìš” -->
      <div class="rating">
        <button onclick="rateNews('good')">ğŸ˜€ (<span id="count-good">0</span>)</button>
        <button onclick="rateNews('normal')">ğŸ™‚ (<span id="count-normal">0</span>)</button>
        <button onclick="rateNews('average')">ğŸ˜ (<span id="count-average">0</span>)</button>
        <button onclick="rateNews('bad')">ğŸ˜Ÿ (<span id="count-bad">0</span>)</button>
        <button onclick="rateNews('verybad')">ğŸ˜¡ (<span id="count-verybad">0</span>)</button>
      </div>


    </main>
    <aside>
      <div class="category">
        <button type="button" class="btn btn-outline-success" value='ì •ì¹˜' id="politics">ì •ì¹˜</button>
        <button type="button" class="btn btn-outline-success" value='ê²½ì œ' id="economy">ê²½ì œ</button>
        <button type="button" class="btn btn-outline-success" value='ì‚¬íšŒ' id="society">ì‚¬íšŒ</button>
        <button type="button" class="btn btn-outline-success" value='ìƒí™œ' id="life">ìƒí™œ</button>
        <button type="button" class="btn btn-outline-success" value='ê³¼í•™' id="science">ê³¼í•™</button>
        <button type="button" class="btn btn-outline-success" value='ì„¸ê³„' id="world">ì„¸ê³„</button>
      </div>
      <h3>ë‹¤ë¥¸ ë‰´ìŠ¤</h3>
      <ul><span id="side_bar"></span></ul>
    </aside>
    <!-- <div class="right-space"></div> -->
  </div>
</body>

</html>